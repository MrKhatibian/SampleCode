// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.33/esri/copyright.txt for details.
//>>built
define("esri/layers/rasterLib/function/CompositeBandFunction","dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin".split(" "),function(h,k,l,p,m,n){return h([l,n],{declaredClass:"esri.layers.rasterLib.function.CompositeBandFunction",functionName:"CompositeBand",supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({rasters:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.rasters)return Error("The rasters input to composite band function is invalid.");
var e=[],b=[],c=a.rasters.length,d;if(a.rasters[0].statistics)for(d=0;d<c;d++)e.push(a.rasters[d].statistics[0]);if(a.rasters[0].histograms)for(d=0;d<c;d++)b.push(a.rasters[d].histograms[0]);this.rasterInfo=k.mixin(a.rasters[0],{bandCount:c,pixelType:this._calculatePixelType(this.pixelType,a.rasters[0].pixelType),statistics:e,histograms:b});return!0},read2D:function(a){a=a.rasters;if(null!=a&&0!==a.length){for(var e=this._clonePixelData(a[0]),b=e.pixelBlock,c=[],d=[],f=0;f<a.length;f++)c.push(a[f].pixelBlock.pixels[0]),
d.push(a[f].pixelBlock.statistics[0]);b.pixels=c;b.stackedStatistics=d;b.planes=a.length;var g,f,d=b.width*b.height;for(f=0;f<a.length;f++)if(b=a[f].pixelBlock.mask,g&&b)for(c=0;c<d;c++)g[c]&=b[c];else g=g||b;e.maks=g;return e}},readGL:function(a){this._performance.start();this._initializeProgram({fragment:m.compositeBand,fragmentName:"CompositeBand"});var e=a.rasters;if(null!=e&&0!==e.length){var e=e.length,b,c,d,f=this.bindFrameBuffer();for(b=0;b<e;b++)c=this._setupTextureData(a.rasters[b],{notOriginal:0<
b}),d=0<b?b.toString():"",this._bindTexture(c.texture,"u_image"+d);this._setUniforms({u_rasterCount:e});this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:c.extent,texture:f.texture}}}})});
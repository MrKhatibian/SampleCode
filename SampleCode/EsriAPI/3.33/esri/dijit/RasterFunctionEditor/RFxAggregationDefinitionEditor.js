// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.33/esri/copyright.txt for details.
//>>built
require({cache:{"url:esri/dijit/RasterFunctionEditor/templates/RFxAggregationDefinitionEditor.html":'\x3cdiv class\x3d"esri-rfx-aggregationdef-editor" data-dojo-attach-point\x3d"aggregationdefBase"\x3e\r\n  \x3cdiv class\x3d"esri-rfx-rasterDimension-select"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_rasterDimensionSelectDiv"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n'}});
define("esri/dijit/RasterFunctionEditor/RFxAggregationDefinitionEditor","dojo/_base/declare dojo/i18n!../../nls/jsapi dojo/text!./templates/RFxAggregationDefinitionEditor.html dojo/_base/lang dojo/_base/array dojo/has dojo/Evented ../../kernel dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/_OnDijitClickMixin ./EditableGridMixin ./RFxGridBase dijit/form/Select dijit/form/NumberTextBox ./RFxRasterDimensionSelect".split(" "),function(h,k,n,f,l,p,B,q,r,t,u,v,w,x,y,z,A){h=
h("RFxAggregationDefinitionEditor",[r,t,u,v,w],{declaredClass:"esri.dijit.RasterFunctionEditor.RFxAggregationDefinitionEditor",templateString:n,widgetsInTemplate:!0,rasterDimensionSelect:null,intervalRangesGrid:null,_intervalKeywordFormTimeUnits:null,_intervalValueFormTimeUnits:null,_dimensionDefinitionSelect:null,_valueIntervalTextbox:null,_intervalKeywordFormTimeUnitsContainer:null,_intervalRangesGridDivContainer:null,_intervalValueDivContainer:null,_intervalValueFormTimeUnitsContainer:null,definitionType:"",
selectedDimension:"",widgetState:null,aggregationDefinitionEnum:{ALL:"ALL",INTERVAL_KEYWORD:"INTERVAL_KEYWORD",INTERVAL_VALUE:"INTERVAL_VALUE",INTERVAL_RANGES:"INTERVAL_RANGES"},aggregationDefinition:{ALL:"aggDefTypeAll",INTERVAL_VALUE:"aggDefTypeIntervalValue",INTERVAL_RANGES:"aggDefTypeIntervalRanges"},esriTimeIntervalKeywords:{HOURLY:"esriTimeIntervalKeywordHourly",DAILY:"esriTimeIntervalKeywordDaily",WEEKLY:"esriTimeIntervalKeywordWeekly",DEKADLY:"esriTimeIntervalKeywordDekadly",PENTADLY:"esriTimeIntervalKeywordPentadly",
MONTHLY:"esriTimeIntervalKeywordMonthly",QUARTERLY:"esriTimeIntervalKeywordQuarterly",YEARLY:"esriTimeIntervalKeywordYearly",RECURRING_DAILY:"esriTimeIntervalKeywordRecurringDaily",RECURRING_WEEKLY:"esriTimeIntervalKeywordRecurringWeekly",RECURRING_MONTHLY:"esriTimeIntervalKeywordRecurringMonthly",RECURRING_QUARTERLY:"esriTimeIntervalKeywordRecurringQuarterly"},esriTimeUnits:{HOURS:"esriTimeUnitsHours",DAYS:"esriTimeUnitsDays",WEEKS:"esriTimeUnitsWeeks",MONTHS:"esriTimeUnitsMonths",YEARS:"esriTimeUnitsYears"},
constructor:function(){this.inherited(arguments);this.widgetState={};this._i18n=k.rasterFunctions.enumLabels;this._i18n=f.mixin(this._i18n,k.rasterFunctions.rfxArgs)},postCreate:function(){this.inherited(arguments);this._generateLabelNode(this._i18n.dimensionName,this.aggregationdefBase,!0);this._generateLabelNode(this._i18n.rasterTypeName,this.aggregationdefBase);this._addBreakLine(this.aggregationdefBase);var a=this._generateDropdownOptions(this.aggregationDefinition);this._dimensionDefinitionSelect=
this._generateDropdownNode(a,this.aggregationdefBase);this._intervalKeywordFormTimeUnitsContainer=document.createElement("div");this._intervalKeywordFormTimeUnitsContainer.classList.add("hidden");this.aggregationdefBase.appendChild(this._intervalKeywordFormTimeUnitsContainer);this._generateLabelNode(this._i18n.dimensionUnit,this._intervalKeywordFormTimeUnitsContainer);this._addBreakLine(this._intervalKeywordFormTimeUnitsContainer);a=this._generateDropdownOptions(this.esriTimeIntervalKeywords);this._intervalKeywordFormTimeUnits=
this._generateDropdownNode(a,this._intervalKeywordFormTimeUnitsContainer);this._intervalValueDivContainer=document.createElement("div");this._intervalValueDivContainer.classList.add("hidden","esri-rfx-aggregationdef-intervalValue-div");this.aggregationdefBase.appendChild(this._intervalValueDivContainer);this._generateLabelNode(this._i18n.predictDimensionInterval,this._intervalValueDivContainer);this._valueIntervalTextbox=this._generateTextBoxNode(this._intervalValueDivContainer);this._intervalValueFormTimeUnitsContainer=
document.createElement("div");this._intervalValueFormTimeUnitsContainer.classList.add("hidden");this._intervalValueDivContainer.appendChild(this._intervalValueFormTimeUnitsContainer);this._generateLabelNode(this._i18n.dimensionUnit,this._intervalValueFormTimeUnitsContainer);this._addBreakLine(this._intervalValueFormTimeUnitsContainer);a=this._generateDropdownOptions(this.esriTimeUnits);this._intervalValueFormTimeUnits=this._generateDropdownNode(a,this._intervalValueFormTimeUnitsContainer);this._intervalRangesGridDivContainer=
document.createElement("div");this._intervalRangesGridDivContainer.classList.add("hidden","esri-rfx-aggregationdef-intervalRanges-grid");this.aggregationdefBase.appendChild(this._intervalRangesGridDivContainer);this._generateLabelNode(this._i18n.rangesName,this._intervalRangesGridDivContainer);if(this.layerArg&&this.layerArg.input){var a=this.layerArg.input,b;this.set("labelAttr","alias");0<a.declaredClass.indexOf("RFxRasterInput")&&a.value&&(b=a.getSelectedLayer(a.get("value").name),b.on("load",
f.hitch(this,function(){b.getMultidimensionalInfo().then(f.hitch(this,function(a){b.multidimensionalInfo=a;this.defaultValue&&this.defaultValue.dimension&&(this.selectedDimension=this.defaultValue.dimension);this.defaultValue&&this.defaultValue.definitionType?(this.definitionType=this.defaultValue&&this.defaultValue.definitionType,a=this._dimensionDefinitionSelect.getOptions("INTERVAL_KEYWORD"),"INTERVAL_KEYWORD"!==this.definitionType||a||this._dimensionDefinitionSelect.addOption({value:"INTERVAL_KEYWORD",
label:this._i18n.aggDefTypeIntervalKeyword}),this._dimensionDefinitionSelect.set("value",this.definitionType),this.widgetState[this.definitionType]=this._cloneData(this.defaultValue)):this.definitionType=this._dimensionDefinitionSelect.value}))})));this._dimensionDefinitionSelect.on("change",this._handleDimensionDefinitionSelectChange.bind(this));this.rasterDimensionSelect=new A({layerArg:this.layerArg,defaultValue:this.defaultValue&&this.defaultValue.dimension},this._rasterDimensionSelectDiv);this.rasterDimensionSelect.startup();
this.rasterDimensionSelect.on("change",function(a){this._handleDimensionSelectChange(a)}.bind(this));this.rasterDimensionSelect.on("raster-dimension-select-update",function(a){this._handleDimensionSelectChange(a[0].name)}.bind(this))}},onRasterChange:function(){if(this.layerArg&&this.layerArg.input){var a=this.layerArg.input,b;0<a.declaredClass.indexOf("RFxRasterInput")&&a.value&&(b=a.getSelectedLayer(a.get("value").name),b.on("load",f.hitch(this,function(){b.getMultidimensionalInfo().then(f.hitch(this,
function(a){b.multidimensionalInfo=a;this.rasterDimensionSelect.onRasterChange();this.widgetState={}}))})))}},_handleDimensionDefinitionSelectChange:function(a){this.definitionType=a;this.defaultValue=this._cloneData(this.widgetState[a]);switch(this.definitionType){case this.aggregationDefinitionEnum.ALL:this._intervalKeywordFormTimeUnitsContainer.classList.add("hidden");this._intervalValueDivContainer.classList.add("hidden");this._intervalRangesGridDivContainer.classList.add("hidden");break;case "INTERVAL_KEYWORD":this._updateIntervalKeywordSelect();
this._intervalKeywordFormTimeUnitsContainer.classList.remove("hidden");this._intervalValueDivContainer.classList.add("hidden");this._intervalRangesGridDivContainer.classList.add("hidden");break;case this.aggregationDefinitionEnum.INTERVAL_VALUE:this._updateIntervalValueForm();this._intervalKeywordFormTimeUnitsContainer.classList.add("hidden");this._intervalValueDivContainer.classList.remove("hidden");this._intervalRangesGridDivContainer.classList.add("hidden");break;case this.aggregationDefinitionEnum.INTERVAL_RANGES:this._createIntervalRangesGrid(),
this._intervalKeywordFormTimeUnitsContainer.classList.add("hidden"),this._intervalValueDivContainer.classList.add("hidden"),this._intervalRangesGridDivContainer.classList.remove("hidden")}},_handleDimensionSelectChange:function(a){this.selectedDimension=a;var b="StdTime"===this.selectedDimension?!1:!0;"StdTime"===a?this._dimensionDefinitionSelect.getOptions("INTERVAL_KEYWORD")||this._dimensionDefinitionSelect.addOption({value:"INTERVAL_KEYWORD",label:this._i18n.aggDefTypeIntervalKeyword}):this._dimensionDefinitionSelect.removeOption("INTERVAL_KEYWORD");
switch(this.definitionType){case "INTERVAL_KEYWORD":b&&(this._dimensionDefinitionSelect.reset(),this._handleDimensionDefinitionSelectChange("ALL"));break;case this.aggregationDefinitionEnum.INTERVAL_VALUE:this._updateIntervalValueForm();break;case this.aggregationDefinitionEnum.INTERVAL_RANGES:this._createIntervalRangesGrid()}},_createIntervalRangesGrid:function(){var a=this._getGridSchema(["MinValue","MaxValue"],["dropdown","dropdown"],[this._i18n.minValue,this._i18n.maxValue]),b=this._getGridData(),
c=this._getDefaultValueObject(b[0]);this.intervalRangesGrid&&this.intervalRangesGrid.destroy();this._intervalRangesGridDiv=document.createElement("div");this._intervalRangesGridDivContainer.appendChild(this._intervalRangesGridDiv);this.intervalRangesGrid=new x({schema:a,data:b,hasIdColumn:!0,isExtensible:!0,defaultBlankObject:c},this._intervalRangesGridDiv);this.intervalRangesGrid.keepScrollPosition=!0;this.intervalRangesGrid.on("grid-data-change",this._handleIntervalRangesGridChange.bind(this))},
_handleIntervalRangesGridChange:function(){console.log("_handlintervalRangesGridChange");this.defaultValue=this._getValueAttr(!0)},_updateIntervalKeywordSelect:function(){var a=this.defaultValue&&this.defaultValue.intervalKeyword;a&&this._intervalKeywordFormTimeUnits.set("value",a)},_updateIntervalValueForm:function(){var a=this.defaultValue&&this.defaultValue.units||"HOURS";this._valueIntervalTextbox.set("value",this.defaultValue&&this.defaultValue.intervalValue||3);"StdTime"===this.selectedDimension?
(this._intervalValueFormTimeUnitsContainer.classList.remove("hidden"),this._intervalValueFormTimeUnits.set("value",a)):this._intervalValueFormTimeUnitsContainer.classList.add("hidden")},_getGridSchema:function(a,b,c){var d=[];return d=a.map(function(a,d){return{label:c[d],name:a,dataType:b[d]}})},_getGridData:function(){var a=[{MinValue:[],MaxValue:[]}];if(!this.layerArg||!this.layerArg.input)return a;var b=this.layerArg.input;this.set("labelAttr","alias");return 0<b.declaredClass.indexOf("RFxRasterInput")&&
b.value?(a=this.layerArg.value&&this.layerArg.value.name||b.get("value").name,b=b.getSelectedLayer(a),this._createIntervalRangesDataObject(b)):a},_getDefaultValueObject:function(a){var b=this._cloneData(a),c={label:" ",value:"",selected:!0,disabled:!0};Object.keys(b).forEach(function(a,g){b[a].unshift(c)},this);return b},_createIntervalRangesDataObject:function(a){var b=[],c=[],d=[],g=[{MinValue:[],MaxValue:[]}];if(!a)return g;var e=a.multidimensionalInfo;if(!e||!e.variables)return g;if(this.defaultValue&&
this.defaultValue.dimension&&0<this.defaultValue.minValues.length&&0<this.defaultValue.maxValues.length){var m=this.defaultValue&&this.defaultValue.minValues,f=this.defaultValue&&this.defaultValue.maxValues;m.forEach(function(a,g){c=this._getDimensionValues(e,this.selectedDimension);d=this._getDimensionValues(e,this.selectedDimension);this._makeDropdownSelection(c,m[g]);this._makeDropdownSelection(d,f[g]);b.push(this._cloneData({MinValue:c,MaxValue:d}))},this)}else c=this._getDimensionValues(e,this.selectedDimension),
d=this._getDimensionValues(e,this.selectedDimension),b.push({MinValue:c,MaxValue:d});return b},_parseIntervalRangesGridData:function(a,b){var c=[],d=[];a.forEach(function(a){if("*"!==a.idNum){var e=a.MinValue.filter(function(a){return a.selected});a=a.MaxValue.filter(function(a){return a.selected});1===e.length&&1===a.length&&(e=e[0].value,a=a[0].value,b||""!==e&&""!==a)&&(c.push(e),d.push(a))}});return{MinValue:c,MaxValue:d}},_getDimensionValues:function(a,b){var c=[];a.variables.forEach(function(a){a.dimensions.forEach(function(a){a.name===
b&&a.values.forEach(function(b){b=a.hasRanges?this._removeDuplicatesFromArray(b).join(" - "):b+"";var d={label:b,value:b,selected:!1,disabled:!1};"StdTime"===a.name&&(b=(new Date(Number(d.value))).toISOString().slice(0,22),d.label=b,d.value=b);this._itemInArray(c,d)||c.push(d)}.bind(this))}.bind(this))}.bind(this));return c},_removeDuplicatesFromArray:function(a){return l.filter(a,function(a,c,d){return l.indexOf(d,a)===c})},_cloneData:function(a){return f.clone(a)},_itemInArray:function(a,b){return a.some(function(a){return a.label===
b.label})},_makeDropdownSelection:function(a,b){var c=!1;a.forEach(function(a){a.value===b?c=a.selected=!0:a.selected=!1});c||a.unshift({label:" ",value:"",selected:!0,disabled:!0})},_addBreakLine:function(a){var b=document.createElement("br");a.appendChild(b)},_generateLabelNode:function(a,b,c){var d=document.createElement("label");d.innerHTML=a;d.classList.add("esri-rfx-args-editor__tr--arg-name","esri-paddingTop-5");c?b.prepend(d):b.appendChild(d)},_generateDropdownNode:function(a,b){var c=document.createElement("div");
b.appendChild(c);return new y({options:a},c)},_generateTextBoxNode:function(a){var b=document.createElement("div");a.appendChild(b);return new z(null,b)},_generateDropdownOptions:function(a){return Object.keys(a).map(function(b){return{value:b,label:this._i18n[a[b]]}}.bind(this))},_getValueAttr:function(a){a||(a=!1);var b=this._dimensionDefinitionSelect.value,c=this.rasterDimensionSelect.get("value"),c={definitionType:b,dimension:c};switch(b){case "INTERVAL_KEYWORD":c.intervalKeyword=this._intervalKeywordFormTimeUnits.get("value");
break;case this.aggregationDefinitionEnum.INTERVAL_VALUE:c.intervalValue=this._valueIntervalTextbox.get("value");"StdTime"===c.dimension&&(c.units=this._intervalValueFormTimeUnits.get("value"));break;case this.aggregationDefinitionEnum.INTERVAL_RANGES:var d=this.intervalRangesGrid.getStoreValue();a=this._parseIntervalRangesGridData(d,a);c.minValues=a.MinValue;c.maxValues=a.MaxValue}this.widgetState[b]=this._cloneData(c);return c}});p("extend-esri")&&f.setObject("dijit.RasterFunctionEditor.RFxAggregationDefinitionEditor",
h,q);return h});
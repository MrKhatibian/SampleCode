// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.33/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/dataDrilling/DataDrillingExportUtil","dojo/_base/lang esri/dijit/geoenrichment/when dojo/dom-construct esri/dijit/geoenrichment/ReportPlayer/ReportPlayer esri/dijit/geoenrichment/ReportPlayer/PlayerResizeModes esri/dijit/geoenrichment/ReportPlayer/PlayerThemes esri/dijit/geoenrichment/ReportPlayer/DataProviderGE esri/dijit/geoenrichment/ReportPlayer/PlayerCommands ../reportContainerGrid/utils/PageQueryUtil ../supportClasses/templateJsonUtils/BlankTemplateJsonUtil ../supportClasses/templateJsonUtils/fieldInfo/FieldInfoBuilder esri/dijit/geoenrichment/utils/DeviceUtil esri/dijit/geoenrichment/utils/WaitingUtil".split(" "),
function(p,k,h,q,r,t,u,f,m,v,w,l,x){var g={reportPlayerClass:q,dataProviderClass:u,initPlayer:function(){var a=h.create("div",{"class":"esriGEAbsoluteStretched esriGEOffscreen"},document.body),b=new g.dataProviderClass;b.registerCommand(f.PRINT);b.registerCommand(f.IMAGE);b=(new g.reportPlayerClass({theme:t.DARK,dataProvider:b,resizeMode:r.FIT_WINDOW,isDataDrillingPlayer:!0})).placeAt(a);b.__playerDiv=a;return b},destroyPlayer:function(a){a.destroy();h.destroy(a.__playerDiv)}},b={},n=!1;b.setReportPlayerClass=
function(a){g.reportPlayerClass=a};b.setDataProviderClass=function(a){g.dataProviderClass=a};b.canPrintDataDrilling=function(a){return l.isMobileDevice()?!1:!!m.getParentReportPlayer(a).dataProvider.getCommandById(f.PRINT)};b.canExportDataDrilling=function(a){return l.isMobileDevice()?!1:(a=m.getParentReportPlayer(a).dataProvider.getCommandById(f.IMAGE))&&a.isBrowserSupported()};b.printDataDrilling=function(a){b._createTemporaryPlayerAndExport(a,!0)};b.exportDataDrilling=function(a){b._createTemporaryPlayerAndExport(a,
!1)};b._createTemporaryPlayerAndExport=function(a,f){if(!n){n=!0;var h,e=m.getParentReportPlayer(a.parentWidget),l=e.getReportData(),e=e.dataProvider.reportDataToSingleAreaReportData(l,{currentFeatureIndex:a.currentFeatureIndex||0,reportTitle:e.getReportTitle(),templateJson:function(){var b=a.getSection().toJson(),d=a.getDataDrillingPanelDimensions(b),d=v.createBlankTemplate({elementWidth:d.w,elementHeight:d.h,layout:{numRows:1,numColumns:1}});d.theme=p.clone(a.theme);delete d.theme.document.backgroundImage;
h=a.getSection().getVisualState();var b=w.createFieldInfoFromSection(b),c=d.sectionsTables[0].data;c.data[0].fieldInfos[c.columns[0].field]=b;return d}()}),c=g.initPlayer();c.onWaitingShown=function(b){x.showProgressPromise(a.dataDrillingViewDiv,b)};c.onCommandSettingsShown=function(a){b.unitTesting_onCommandSettingsShown()};k(c.setReportData(e,{waitUntilAllContentIsReady:!0,disableAnimation:!0}),function(){var e={pages:[{cells:[h]}]},d=c.getCurrentReportContainer().getLayoutCells()[0].content;d.getPreviewValueFunction=
a.getPreviewValueFunction;return k(d.refresh()).then(function(){return k(c.onWaitingShown(c.getCurrentReportContainer().setVisualState(e)),function(){return k(c[f?"executePrint":"executeExport"](),function(a){g.destroyPlayer(c);b.unitTesting_onExportCommandFinished(a)})})})})["finally"](function(){n=!1})}};b.unitTesting_onCommandSettingsShown=function(){};b.unitTesting_onExportCommandFinished=function(a){};return b});
// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.33/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/utils/FileUtil",["esri/dijit/geoenrichment/Deferred","esri/dijit/geoenrichment/when","./DataUtil","./ImageUtil"],function(f,l,k,m){function h(){return new f.reject(Error("Saving not supported."))}var e=h,n=/[\\/:*?"<>|]/g,a={savingSupported:function(){return void 0!==window.Blob},saveTextFile:function(b,d,c,p){return a.savingSupported()?a.saveAs(new Blob([b],{type:c||"text/plain"}),d||"text.txt",p):h()},saveImageFile:function(b,d){if(a.savingSupported()){var c;"string"===
typeof b?(c=m.base64DataFromDataURL(b),c=k.binaryStringToByteArray(atob(c)).buffer):b instanceof ArrayBuffer&&(c=b);return a.saveAs(c?k.arrayBuffersToBlob([c],"image/png"):b,d)}h()},_queue:[],_isSavePendingFlag:!1,_saveTimeoutH:null,saveAs:function(b,d,c){return c&&c.addDownloadIntervals?(c=new f,a._queue.push({blob:b,name:d||"download",dfd:c}),a._trySaveAsNext(),c.promise):e(b,a.validateName(d||"download"))},_trySaveAsNext:function(){if(a._queue.length&&!a._isSavePendingFlag){var b=a._queue.shift();
a._isSavePendingFlag=!0;l(e(b.blob,a.validateName(b.name))).then(b.dfd.resolve,b.dfd.reject).always(function(){setTimeout(function(){a._isSavePendingFlag=!1;a._trySaveAsNext()},100)})}},validateName:function(b){return String(b).trim().replace(n,"")}};if(!a.savingSupported())return a;if(window.navigator&&window.navigator.msSaveOrOpenBlob)return e=function(b,a){var c=new f;window.navigator.msSaveOrOpenBlob(b,a)?c.resolve():c.reject(Error("Failed to save or open downloaded file."));return c.promise},
a;var g=window.URL||window.webkitURL;if("download"in window.document.createElement("a")){var q=function(b){var a;void 0!==window.MouseEvent?a=new MouseEvent("click",{bubbles:!0,cancelable:!1}):(a=document.createEvent("MouseEvent"),a.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null));b.dispatchEvent(a)},e=function(b,a){var c=new f,d=g.createObjectURL(b),e=window.document.createElement("a");e.href=d;e.download=a;q(e);setTimeout(function(){g.revokeObjectURL(d);e=null;c.resolve();c=null},
1E3);return c.promise};return a}e=function(a,d){var c=new f;a=new File([a],d,{type:a.type});var b=g.createObjectURL(a);window.open(b,"_blank");setTimeout(function(){g.revokeObjectURL(b);c.resolve()},1E3);return c.promise};return a});